<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Rotina FÃ¡cil</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}
body.dark { background: #121212; color: #fff; }

.container {
  max-width: 500px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
}
body.dark .container { background: #1e1e1e; }

h1 {
  display: flex;
  justify-content: space-between;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
}

.add-btn {
  background: #4CAF50;
  color: #fff;
  border: none;
  cursor: pointer;
}

.task {
  background: #f1f1f1;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
}
body.dark .task { background: #2a2a2a; }

.done span {
  text-decoration: line-through;
  opacity: 0.6;
}

.time {
  font-size: 13px;
  opacity: 0.7;
  margin-right: 6px;
}

.priority {
  font-weight: bold;
  margin-right: 6px;
}

.low { color: #2e7d32; }
.normal { color: #f9a825; }
.high { color: #c62828; }

.section-title {
  margin-top: 18px;
  font-weight: bold;
}

.progress {
  margin-top: 8px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
}
.progress-bar {
  height: 20px;
  background: #4CAF50;
  width: 0%;
  transition: 0.3s;
}
body.dark .progress { background: #333; }
</style>
</head>

<body>

<div class="container">
  <h1>
    Minha Rotina
    <span onclick="toggleDark()">ðŸŒ™</span>
  </h1>

  <div class="section-title">
    ðŸŽ¯ Pontos do ano: <span id="pointsText">0</span> / 10000
  </div>
  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <input type="date" id="currentDate">
  <input type="time" id="taskTime">

  <select id="taskPriority">
    <option value="normal">ðŸŸ¡ Prioridade Normal</option>
    <option value="high">ðŸ”´ Prioridade Alta</option>
    <option value="low">ðŸŸ¢ Prioridade Baixa</option>
  </select>

  <input type="text" id="taskInput" placeholder="Nova tarefa">
  <button type="button" class="add-btn" onclick="addTask()">Adicionar</button>

  <div class="section-title">ðŸ“… Tarefas do dia</div>
  <div id="taskList"></div>

  <div class="section-title">ðŸ“œ HistÃ³rico</div>
  <div id="historyList"></div>
</div>

<script>
let tasks = [];
const MAX_POINTS_YEAR = 10000;

const currentDate = document.getElementById('currentDate');
const taskInput = document.getElementById('taskInput');
const taskTime = document.getElementById('taskTime');
const taskPriority = document.getElementById('taskPriority');
const taskList = document.getElementById('taskList');
const historyList = document.getElementById('historyList');
const pointsText = document.getElementById('pointsText');
const progressBar = document.getElementById('progressBar');

function isValidDateStr(str) {
  return /^\d{4}-\d{2}-\d{2}$/.test(str);
}
function safeDate(str) {
  const [y, m, d] = str.split('-').map(Number);
  return new Date(y, m - 1, d);
}
function getYearFromDate(str) {
  return safeDate(str).getFullYear();
}

(function setToday() {
  const today = new Date();
  today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
  currentDate.value = today.toISOString().split('T')[0];
})();

function calculatePointsForYear(year) {
  return tasks.filter(
    t => t.done && t.counted && getYearFromDate(t.date) === year
  ).length;
}

function updatePoints() {
  const year = getYearFromDate(currentDate.value);
  const points = calculatePointsForYear(year);
  pointsText.innerText = points;
  progressBar.style.width = Math.min((points / MAX_POINTS_YEAR) * 100, 100) + '%';
}

function addTask() {
  if (!taskInput.value.trim() || !taskTime.value || !isValidDateStr(currentDate.value)) return;

  tasks.push({
    id: Date.now(),
    text: taskInput.value.trim(),
    date: currentDate.value,
    time: taskTime.value,
    priority: taskPriority.value,
    done: false,
    counted: false
  });

  taskInput.value = '';
  taskTime.value = '';
  render();
}

function toggleTask(id) {
  const task = tasks.find(t => t.id === id);
  if (!task || task.done) return;

  const year = getYearFromDate(task.date);
  if (calculatePointsForYear(year) >= MAX_POINTS_YEAR) {
    alert("Limite anual de pontos atingido.");
    return;
  }

  task.done = true;
  task.counted = true;
  render();
}

const priorityOrder = { high: 1, normal: 2, low: 3 };
const priorityLabel = {
  high: "ðŸ”´ ALTA",
  normal: "ðŸŸ¡ NORMAL",
  low: "ðŸŸ¢ BAIXA"
};

function render() {
  taskList.innerHTML = '';
  historyList.innerHTML = '';

  const selectedDate = currentDate.value;

  tasks
    .filter(t => t.date === selectedDate && !t.done)
    .sort((a, b) =>
      priorityOrder[a.priority] - priorityOrder[b.priority] ||
      a.time.localeCompare(b.time)
    )
    .forEach(t => {
      taskList.innerHTML += `
        <div class="task">
          <input type="checkbox" onclick="toggleTask(${t.id})">
          <span class="priority ${t.priority}">${priorityLabel[t.priority]}</span>
          <span class="time">${t.time}</span>
          <span>${t.text}</span>
        </div>
      `;
    });

  const grouped = {};
  tasks.forEach(t => {
    if (!grouped[t.date]) grouped[t.date] = [];
    grouped[t.date].push(t);
  });

  Object.keys(grouped)
    .sort((a, b) => safeDate(a) - safeDate(b))
    .forEach(date => {
      historyList.innerHTML += `
        <div class="section-title">ðŸ“… ${safeDate(date).toLocaleDateString('pt-BR')}</div>
      `;
      grouped[date]
        .sort((a, b) =>
          priorityOrder[a.priority] - priorityOrder[b.priority] ||
          a.time.localeCompare(b.time)
        )
        .forEach(t => {
          historyList.innerHTML += `
            <div class="task ${t.done ? 'done' : ''}">
              <span class="priority ${t.priority}">${priorityLabel[t.priority]}</span>
              <span class="time">${t.time}</span>
              <span>${t.text}</span>
            </div>
          `;
        });
    });

  updatePoints();
}

function toggleDark() {
  document.body.classList.toggle('dark');
}

render();
</script>

</body>
</html>
